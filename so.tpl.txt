{  
   "Resources":{  
      "MySpotFleet":{  
         "Type":"AWS::EC2::SpotFleet",
         "Properties":{  
            "SpotFleetRequestConfigData":{  
               "TargetCapacity":1,
               "IamFleetRole":"arn:aws:iam::302378362623:role/aws-ec2-spot-fleet-tagging-role",
               "LaunchSpecifications":[  
                  {  
                     "ImageId":"ami-0b898040803850657",
                     "KeyName":"dec15a",
                     "SecurityGroups":[  
                        {  
                           "GroupId":"sg-6eb04005"
                        }
                     ],
                     "InstanceType":"m3.medium",
                     "IamInstanceProfile":{  
                        "Arn":"arn:aws:iam::302378362623:instance-profile/my_new_role"
                     },
                     "BlockDeviceMappings":[  
                        {  
                           "DeviceName":"/dev/xvda",
                           "Ebs":{  
                              "DeleteOnTermination":true,
                              "VolumeType":"standard",
                              "VolumeSize":400
                           }
                        }
                     ],
                     "UserData":{  
                        "Fn::Base64":{  
                           "Fn::Join":[  
                              "",
                              [  
                                 "#!/bin/bash -xe\n",
                                 "yum install -y docker mysql git python-pip > /tmp/line1_succ.txt 2> /tmp/line1_err.txt\n",
                                 "service docker start > /tmp/line2_succ.txt 2> /tmp/line2_err.txt \n",
                                 "docker run -d -p 8887:8888 -v /tmp:/tmp shantanuo/notebook > /tmp/line3_succ.txt 2> /tmp/line3_err.txt \n",
                                 "pip install aws-ec2-assign-elastic-ip > /tmp/line4_succ.txt 2> /tmp/line4_err.txt \n ",
                                 "sudo sh -c \"echo ",
                                 {  
                                    "Fn::ImportValue":"secretKey"
                                 },
                                 " >> /home/ec2-user/mysecret.txt\" \n",
                                 "sudo sh -c \"echo ",
                                 {  
                                    "Fn::ImportValue":"accessKey"
                                 },
                                 " >> /home/ec2-user/myaccesskey.txt\" \n",
                                 "/usr/local/bin/aws-ec2-assign-elastic-ip --access-key ''`cat /home/ec2-user/myaccesskey.txt`''  --secret-key ''`cat /home/ec2-user/mysecret.txt`'' --valid-ips 18.210.57.140 > /tmp/line5_succ.txt 2> /tmp/line5_err.txt \n "
                              ]
                           ]
                        }
                     }
                  }
               ]
            }
         }
      }
   }
}